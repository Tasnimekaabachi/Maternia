{% extends 'admin/base.html.twig' %}

{% block title %}Catégories d'événements - Administration{% endblock %}
{% block page_title %}Gestion des Catégories{% endblock %}

{% block breadcrumb %}
    <nav aria-label="breadcrumb" class="premium-breadcrumb-wrapper">
        <ol class="premium-breadcrumb">
            <li class="pb-item">
                <a href="{{ path('admin_dashboard') }}">
                    <i class="fas fa-home"></i>
                </a>
            </li>
            <li class="pb-separator"><i class="fas fa-chevron-right"></i></li>
            <li class="pb-item">
                <a href="{{ path('admin_evenements') }}">Événements & Catégories</a>
            </li>
            <li class="pb-separator"><i class="fas fa-chevron-right"></i></li>
            <li class="pb-item active">Catégories</li>
        </ol>
    </nav>
{% endblock %}

{% block header_actions %}
    <div class="d-flex gap-2">
        <a href="{{ path('app_event_cat_pdf') }}" class="btn ci-btn-outline rounded-pill px-4 shadow-sm">
            <i class="fas fa-file-pdf me-1"></i> PDF
        </a>
        <a href="{{ path('app_event_cat_csv') }}" class="btn ci-btn-outline rounded-pill px-4 shadow-sm">
            <i class="fas fa-file-csv me-1"></i> CSV
        </a>
        <a href="{{ path('app_event_cat_new') }}" class="btn ci-btn-create rounded-pill px-4 shadow-sm">
            <i class="fas fa-plus me-1"></i> Créer
        </a>
    </div>
{% endblock %}

{% block content %}
    {# ── STAT CARDS ── #}
    {% set totalCats = event_cats|length %}
    {% set totalEventsAll = 0 %}
    {% set totalParticipantsAll = 0 %}
    {% set emptyCats = 0 %}
    {% for cat in event_cats %}
        {% set totalEventsAll = totalEventsAll + cat.events|length %}
        {% if cat.events|length == 0 %}
            {% set emptyCats = emptyCats + 1 %}
        {% endif %}
        {% for event in cat.events %}
            {% set totalParticipantsAll = totalParticipantsAll + event.attendances|length %}
        {% endfor %}
    {% endfor %}

    <div class="ci-stats-grid">
        <div class="ci-stat-card ci-stat-total">
            <div class="ci-stat-icon"><i class="fas fa-tags"></i></div>
            <div class="ci-stat-info">
                <span class="ci-stat-value">{{ totalCats }}</span>
                <span class="ci-stat-label">Catégories</span>
            </div>
        </div>
        <div class="ci-stat-card ci-stat-events">
            <div class="ci-stat-icon"><i class="fas fa-calendar-alt"></i></div>
            <div class="ci-stat-info">
                <span class="ci-stat-value">{{ totalEventsAll }}</span>
                <span class="ci-stat-label">Événements liés</span>
            </div>
        </div>
        <div class="ci-stat-card ci-stat-participants">
            <div class="ci-stat-icon"><i class="fas fa-users"></i></div>
            <div class="ci-stat-info">
                <span class="ci-stat-value">{{ totalParticipantsAll }}</span>
                <span class="ci-stat-label">Participants</span>
            </div>
        </div>
        <div class="ci-stat-card ci-stat-empty">
            <div class="ci-stat-icon"><i class="fas fa-folder-open"></i></div>
            <div class="ci-stat-info">
                <span class="ci-stat-value">{{ emptyCats }}</span>
                <span class="ci-stat-label">Sans événement</span>
            </div>
        </div>
    </div>

    {# ── MAIN LIST CARD ── #}
    <div class="ci-main-card">
        <div class="ci-card-header">
            <div class="ci-header-top">
                <h5 class="ci-card-title">
                    <div class="ci-title-icon"><i class="fas fa-tags"></i></div>
                    Liste des catégories
                </h5>
                <div class="d-flex gap-2 align-items-center">
                    {% if searchTerm or sortBy != 'name' or sortOrder != 'ASC' %}
                        <a href="{{ path('app_event_cat_index') }}" class="btn ci-btn-reset" title="Réinitialiser">
                            <i class="fas fa-sync-alt me-1"></i> Réinitialiser
                        </a>
                    {% endif %}
                </div>
            </div>

            <form method="get" action="{{ path('app_event_cat_index') }}">
                <div class="ci-search-bar">
                    <i class="fas fa-search ci-search-icon"></i>
                    <input type="text" 
                           name="search" 
                           class="ci-search-input" 
                           placeholder="Rechercher une catégorie..." 
                           value="{{ searchTerm|default('') }}">
                    <button type="submit" class="btn ci-btn-search">Rechercher</button>
                </div>
            </form>
        </div>

        <div class="ci-card-body">
            <div class="table-responsive">
                <table class="ci-table">
                    <thead>
                        <tr>
                            <th class="ps-4">
                                <a href="{{ path('app_event_cat_index', {search: searchTerm, sort_by: 'name', sort_order: sortBy == 'name' and sortOrder == 'ASC' ? 'DESC' : 'ASC'}) }}" class="ci-th-link">
                                    NOM {% if sortBy == 'name' %}<i class="fas fa-sort-{{ sortOrder == 'ASC' ? 'up' : 'down' }}"></i>{% endif %}
                                </a>
                            </th>
                            <th>DESCRIPTION</th>
                            <th>
                                <a href="{{ path('app_event_cat_index', {search: searchTerm, sort_by: 'eventCount', sort_order: sortBy == 'eventCount' and sortOrder == 'ASC' ? 'DESC' : 'ASC'}) }}" class="ci-th-link">
                                    ÉVÉNEMENTS {% if sortBy == 'eventCount' %}<i class="fas fa-sort-{{ sortOrder == 'ASC' ? 'up' : 'down' }}"></i>{% endif %}
                                </a>
                            </th>
                            <th>
                                <a href="{{ path('app_event_cat_index', {search: searchTerm, sort_by: 'participantCount', sort_order: sortBy == 'participantCount' and sortOrder == 'ASC' ? 'DESC' : 'ASC'}) }}" class="ci-th-link">
                                    PARTICIPANTS {% if sortBy == 'participantCount' %}<i class="fas fa-sort-{{ sortOrder == 'ASC' ? 'up' : 'down' }}"></i>{% endif %}
                                </a>
                            </th>
                            <th class="text-end pe-4">ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if event_cats|length == 0 %}
                            <tr>
                                <td colspan="5">
                                    <div class="ci-empty-state">
                                        <div class="ci-empty-icon"><i class="fas fa-folder-open"></i></div>
                                        <p class="ci-empty-text">Aucune catégorie trouvée.</p>
                                        <a href="{{ path('app_event_cat_new') }}" class="btn ci-btn-create rounded-pill px-4 mt-2">
                                            <i class="fas fa-plus me-1"></i> Nouvelle catégorie
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {% else %}
                            {% for event_cat in event_cats %}
                                <tr class="ci-row">
                                    <td class="ps-4">
                                        <div class="ci-cat-info">
                                            <div class="ci-cat-icon">
                                                <i class="fas fa-tag"></i>
                                            </div>
                                            <h6 class="ci-cat-name">{{ event_cat.name }}</h6>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="ci-description">
                                            {{ event_cat.description ? event_cat.description : '—' }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="ci-event-count">
                                            <i class="fas fa-calendar-alt me-1"></i>
                                            {{ event_cat.events|length }} événement{{ event_cat.events|length > 1 ? 's' : '' }}
                                        </span>
                                    </td>
                                    <td>
                                        {% set catParticipants = 0 %}
                                        {% for event in event_cat.events %}
                                            {% set catParticipants = catParticipants + event.attendances|length %}
                                        {% endfor %}
                                        <span class="ci-participant-count">
                                            <i class="fas fa-users me-1"></i> {{ catParticipants }}
                                        </span>
                                    </td>
                                    <td class="text-end pe-4">
                                        <div class="ci-actions">
                                            <a href="{{ path('app_event_cat_show', {id: event_cat.id}) }}" class="ci-action-btn ci-action-view" title="Voir">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{{ path('app_event_cat_edit', {id: event_cat.id}) }}" class="ci-action-btn ci-action-edit" title="Modifier">
                                                <i class="fas fa-pen"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
            <div class="ci-pagination">
                <small class="ci-pagination-info">Affichage de {{ event_cats|length }} catégorie(s)</small>
                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item disabled"><a class="page-link ci-page-link" href="#">Précédent</a></li>
                        <li class="page-item active"><a class="page-link ci-page-link" href="#">1</a></li>
                        <li class="page-item disabled"><a class="page-link ci-page-link" href="#">Suivant</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <style>
        /* ===== MATERNIA PREMIUM CATEGORY INDEX ===== */
        :root {
            --ci-pink: #ec4899;
            --ci-pink-light: #fce7f3;
            --ci-pink-dark: #be185d;
            --ci-blue: #4a7ba7;
            --ci-green: #10b981;
            --ci-green-light: #d1fae5;
            --ci-orange: #f59e0b;
            --ci-orange-light: #fef3c7;
            --ci-purple: #8b5cf6;
            --ci-purple-light: #ede9fe;
        }

        /* ── STAT CARDS ── */
        .ci-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .ci-stat-card {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            border: 1px solid #f3f4f6;
            box-shadow: 0 4px 20px -5px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }

        .ci-stat-card::before {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 3px;
            border-radius: 0 0 16px 16px;
            transition: height 0.3s ease;
        }

        .ci-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px -8px rgba(0,0,0,0.12);
        }

        .ci-stat-card:hover::before { height: 4px; }

        .ci-stat-total::before { background: var(--ci-pink); }
        .ci-stat-events::before { background: var(--ci-blue); }
        .ci-stat-participants::before { background: var(--ci-green); }
        .ci-stat-empty::before { background: var(--ci-orange); }

        .ci-stat-icon {
            width: 52px; height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .ci-stat-total .ci-stat-icon { background: var(--ci-pink-light); color: var(--ci-pink); }
        .ci-stat-events .ci-stat-icon { background: rgba(74, 123, 167, 0.12); color: var(--ci-blue); }
        .ci-stat-participants .ci-stat-icon { background: var(--ci-green-light); color: var(--ci-green); }
        .ci-stat-empty .ci-stat-icon { background: var(--ci-orange-light); color: var(--ci-orange); }

        .ci-stat-info { display: flex; flex-direction: column; }

        .ci-stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            line-height: 1.2;
            color: #1f2937;
        }

        .ci-stat-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ── MAIN CARD ── */
        .ci-main-card {
            background: white;
            border-radius: 20px;
            border: 1px solid #f3f4f6;
            box-shadow: 0 4px 25px -5px rgba(0,0,0,0.06);
            overflow: hidden;
        }

        .ci-card-header {
            padding: 1.5rem 1.75rem;
            border-bottom: 1px solid #f3f4f6;
            background: linear-gradient(180deg, #ffffff 0%, #fefefe 100%);
        }

        .ci-header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .ci-card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .ci-title-icon {
            width: 38px; height: 38px;
            background: var(--ci-pink-light);
            color: var(--ci-pink);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        /* ── SEARCH BAR ── */
        .ci-search-bar {
            display: flex;
            align-items: center;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 0.25rem 0.25rem 0.25rem 1rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 1rem;
        }

        .ci-search-bar:focus-within {
            border-color: var(--ci-pink);
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
            background: white;
        }

        .ci-search-icon { color: #9ca3af; margin-right: 0.75rem; font-size: 0.9rem; }

        .ci-search-input {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            font-size: 0.9rem;
            color: #374151;
            padding: 0.5rem 0;
        }

        .ci-search-input::placeholder { color: #d1d5db; }

        .ci-btn-search {
            background: var(--ci-pink);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 0.5rem 1.25rem;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .ci-btn-search:hover { background: var(--ci-pink-dark); color: white; transform: translateY(-1px); }

        .ci-btn-reset {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
            color: #9ca3af;
            transition: all 0.2s ease;
        }

        .ci-btn-reset:hover { border-color: #ef4444; color: #ef4444; background: #fee2e2; }

        .ci-btn-outline {
            border: 2px solid var(--ci-pink);
            color: var(--ci-pink);
            background: transparent;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .ci-btn-outline:hover { background: var(--ci-pink-light); color: var(--ci-pink-dark); }

        .ci-btn-create {
            background: linear-gradient(135deg, var(--ci-pink) 0%, var(--ci-pink-dark) 100%);
            color: white;
            border: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .ci-btn-create:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -5px rgba(236, 72, 153, 0.4);
        }

        /* ── TABLE ── */
        .ci-card-body { padding: 0; }

        .ci-table { width: 100%; border-collapse: collapse; }

        .ci-table thead tr { background: #f9fafb; }

        .ci-table th {
            padding: 0.85rem 1rem;
            font-size: 0.7rem;
            font-weight: 700;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 1px solid #f3f4f6;
        }

        .ci-th-link { color: #9ca3af; text-decoration: none; transition: color 0.2s; }
        .ci-th-link:hover { color: var(--ci-pink); }
        .ci-th-link i { margin-left: 4px; font-size: 0.65rem; }

        .ci-table td {
            padding: 1rem;
            border-bottom: 1px solid #f9fafb;
            vertical-align: middle;
            font-size: 0.9rem;
        }

        .ci-row { transition: all 0.2s ease; }

        .ci-row:hover {
            background: linear-gradient(90deg, var(--ci-pink-light) 0%, transparent 100%);
        }

        .ci-row:hover .ci-cat-name { color: var(--ci-pink); }

        /* ── CATEGORY INFO ── */
        .ci-cat-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .ci-cat-icon {
            width: 36px; height: 36px;
            background: var(--ci-pink-light);
            color: var(--ci-pink);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .ci-cat-name {
            font-size: 0.9rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            transition: color 0.2s;
        }

        .ci-description {
            color: #9ca3af;
            font-size: 0.85rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            max-width: 300px;
        }

        .ci-event-count {
            display: inline-flex;
            align-items: center;
            padding: 4px 14px;
            background: white;
            border: 1px solid rgba(74, 123, 167, 0.3);
            color: var(--ci-blue);
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ci-participant-count {
            display: inline-flex;
            align-items: center;
            padding: 4px 14px;
            background: white;
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--ci-green);
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* ── ACTION BUTTONS ── */
        .ci-actions { display: flex; gap: 0.5rem; justify-content: flex-end; }

        .ci-action-btn {
            width: 34px; height: 34px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .ci-action-view {
            background: #eff6ff;
            color: #3b82f6;
            border: 1px solid #dbeafe;
        }

        .ci-action-view:hover {
            background: #3b82f6;
            color: white;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .ci-action-edit {
            background: var(--ci-orange-light);
            color: var(--ci-orange);
            border: 1px solid #fde68a;
        }

        .ci-action-edit:hover {
            background: var(--ci-orange);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        /* ── EMPTY STATE ── */
        .ci-empty-state { padding: 4rem 2rem; text-align: center; }

        .ci-empty-icon {
            width: 80px; height: 80px;
            background: #f9fafb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.25rem;
            font-size: 2rem;
            color: #d1d5db;
            border: 2px dashed #e5e7eb;
        }

        .ci-empty-text { color: #9ca3af; font-weight: 600; font-size: 1rem; margin-bottom: 0; }

        /* ── PAGINATION ── */
        .ci-pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem 1.75rem;
            border-top: 1px solid #f3f4f6;
        }

        .ci-pagination-info { color: #9ca3af; font-weight: 600; }

        .ci-page-link { border-radius: 8px !important; font-weight: 600; font-size: 0.8rem; }

        .page-item.active .ci-page-link { background: var(--ci-pink); border-color: var(--ci-pink); }

        /* ── ANIMATIONS ── */
        .ci-stat-card, .ci-main-card { animation: ciFadeIn 0.4s ease-out; }

        @keyframes ciFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ci-stat-card:nth-child(2) { animation-delay: 0.05s; }
        .ci-stat-card:nth-child(3) { animation-delay: 0.1s; }
        .ci-stat-card:nth-child(4) { animation-delay: 0.15s; }

        @media (max-width: 768px) {
            .ci-stats-grid { grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
            .ci-header-top { flex-direction: column; align-items: flex-start; }
            .ci-search-bar { min-width: 100%; }
            .ci-stat-card { padding: 1rem; }
            .ci-stat-value { font-size: 1.25rem; }
        }
    </style>
{% endblock %}