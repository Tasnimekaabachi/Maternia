{% extends 'base.html.twig' %}

{% block title %}üå∏ R√©server - Consultation en Ligne - Maternia{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
/* üåÖ Palette de couleurs bleu ciel et rose professionnelle */
:root {
    --sky-blue: #7EC8E3;
    --light-pink: #FF9BC9;
    --violet: #A45DE2;
    --deep-blue: #4A6FA5;
    --soft-pink: #FFC2E2;
    --gold: #FFD166;
    --white-glass: rgba(255, 255, 255, 0.95);
    --primary-gradient: linear-gradient(135deg, var(--sky-blue) 0%, var(--light-pink) 100%);
    --secondary-gradient: linear-gradient(135deg, var(--violet) 0%, var(--deep-blue) 100%);
    --accent-gradient: linear-gradient(45deg, var(--sky-blue), var(--light-pink), var(--violet));
    --card-bg: rgba(255, 255, 255, 0.98);
    --shadow-color: rgba(126, 200, 227, 0.15);
    --pink-shadow: rgba(255, 155, 201, 0.1);
    --success-green: #10B981;
    --error-red: #EF4444;
}

/* üéÄ Container principal √©l√©gant */
.reservation-container {
    background: linear-gradient(135deg, 
        #f8fbff 0%,
        #f0f7ff 25%,
        #fff5fb 50%,
        #f9f5ff 75%,
        #f8fbff 100%
    );
    min-height: 100vh;
    padding: 30px 0;
    position: relative;
    overflow-x: hidden;
}

.reservation-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 10% 90%, rgba(126, 200, 227, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 90% 10%, rgba(255, 155, 201, 0.08) 0%, transparent 40%);
    z-index: 0;
}

/* ‚ú® Carte de r√©servation professionnelle */
.reservation-card {
    background: var(--card-bg);
    border-radius: 24px;
    padding: 35px;
    margin: 0 auto 25px;
    box-shadow: 
        0 10px 40px var(--shadow-color),
        0 1px 3px rgba(0, 0, 0, 0.05),
        0 0 0 1px rgba(255, 255, 255, 0.8) inset;
    border: 1px solid rgba(255, 255, 255, 0.9);
    position: relative;
    z-index: 1;
    max-width: 1000px;
    overflow: hidden;
}

.reservation-card::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 120px;
    height: 120px;
    background: linear-gradient(135deg, var(--sky-blue) 0%, var(--light-pink) 100%);
    border-radius: 0 0 0 100%;
    opacity: 0.05;
}

/* üå∏ Titre principal */
.main-title {
    font-size: 2.5rem;
    font-weight: 800;
    text-align: center;
    margin-bottom: 30px;
    color: var(--deep-blue);
    position: relative;
    padding-bottom: 15px;
}

.main-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 150px;
    height: 3px;
    background: var(--primary-gradient);
    border-radius: 2px;
}

/* üéÄ En-t√™te du m√©decin compact */
.doctor-header {
    background: linear-gradient(135deg, 
        rgba(126, 200, 227, 0.1), 
        rgba(255, 155, 201, 0.1)
    );
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 35px;
    border-left: 4px solid var(--sky-blue);
    position: relative;
    overflow: hidden;
}

.doctor-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 80px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3));
}

.doctor-info {
    display: flex;
    align-items: center;
    gap: 25px;
    margin-bottom: 15px;
}

.doctor-avatar {
    width: 70px;
    height: 70px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 8px 20px rgba(126, 200, 227, 0.3);
}

.doctor-details {
    flex: 1;
}

.doctor-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--deep-blue);
    margin-bottom: 5px;
}

.doctor-specialty {
    color: #666;
    font-size: 1rem;
    margin-bottom: 5px;
}

.appointment-details {
    background: white;
    border-radius: 12px;
    padding: 15px 20px;
    display: inline-flex;
    gap: 25px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #555;
}

.detail-icon {
    color: var(--sky-blue);
    font-size: 18px;
}

/* üé® Formulaire professionnel compact */
.form-section {
    margin-bottom: 35px;
}

.section-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--deep-blue);
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(126, 200, 227, 0.2);
    position: relative;
}

.section-title::before {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 60px;
    height: 2px;
    background: var(--primary-gradient);
    border-radius: 2px;
}

/* Grille optimis√©e */
.form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
}

@media (min-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr 1fr;
    }
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #4a5568;
    font-size: 0.95rem;
    position: relative;
    padding-left: 25px;
}

.form-label.required::after {
    content: '*';
    color: var(--error-red);
    margin-left: 4px;
}

.form-label::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
    background: var(--primary-gradient);
    border-radius: 4px;
    opacity: 0.7;
}

.form-control {
    width: 100%;
    padding: 14px 18px 14px 45px;
    background: white;
    border: 1.5px solid #e2e8f0;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
    color: #2d3748;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
}

.form-control:focus {
    border-color: var(--sky-blue);
    box-shadow: 0 0 0 3px rgba(126, 200, 227, 0.15);
    outline: none;
    transform: translateY(-1px);
}

.form-control::placeholder {
    color: #a0aec0;
}

.input-wrapper {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--sky-blue);
    font-size: 18px;
    z-index: 1;
}

/* üé≠ S√©lecteurs √©l√©gants */
.selection-group {
    margin-bottom: 25px;
}

.selection-label {
    display: block;
    margin-bottom: 12px;
    font-weight: 600;
    color: #4a5568;
    font-size: 0.95rem;
}

.options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-top: 8px;
}

.option-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.option-card:hover {
    border-color: var(--sky-blue);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(126, 200, 227, 0.15);
}

.option-card.selected {
    background: linear-gradient(135deg, 
        rgba(126, 200, 227, 0.08), 
        rgba(255, 155, 201, 0.08)
    );
    border-color: var(--sky-blue);
    box-shadow: 0 8px 20px rgba(126, 200, 227, 0.2);
}

.option-icon {
    font-size: 36px;
    margin-bottom: 12px;
    display: block;
    height: 40px;
}

.option-text {
    font-weight: 600;
    color: #2d3748;
    font-size: 1rem;
    display: block;
}

/* Champs conditionnels */
.conditional-fields {
    background: rgba(126, 200, 227, 0.05);
    border-radius: 12px;
    padding: 20px;
    margin-top: 15px;
    border-left: 3px solid var(--sky-blue);
    animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* üìù Zone de texte */
.textarea-group {
    grid-column: 1 / -1;
}

textarea.form-control {
    min-height: 120px;
    resize: vertical;
    line-height: 1.5;
}

/* ‚ú® Bouton d'action principal */
.action-button {
    background: var(--primary-gradient);
    color: white;
    border: none;
    padding: 18px 40px;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    width: 100%;
    margin-top: 30px;
    position: relative;
    overflow: hidden;
    letter-spacing: 0.5px;
    box-shadow: 0 10px 25px rgba(126, 200, 227, 0.3);
}

.action-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent, 
        rgba(255, 255, 255, 0.2), 
        transparent
    );
    transition: left 0.6s;
}

.action-button:hover::before {
    left: 100%;
}

.action-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(126, 200, 227, 0.4);
}

.action-button:active {
    transform: translateY(-1px);
}

.action-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

/* üåü Modal de confirmation professionnel */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 20px;
}

.modal-content {
    background: var(--card-bg);
    border-radius: 24px;
    width: 100%;
    max-width: 700px;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
    animation: modalSlideIn 0.4s ease;
    position: relative;
}

@keyframes modalSlideIn {
    from { opacity: 0; transform: translateY(-30px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-header {
    background: var(--primary-gradient);
    color: white;
    padding: 30px;
    border-radius: 24px 24px 0 0;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.modal-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.1) 50%, transparent 60%);
    animation: shine 2s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.success-icon {
    width: 80px;
    height: 80px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: var(--success-green);
    margin: 0 auto 20px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    animation: bounceIn 0.6s ease;
}

@keyframes bounceIn {
    0% { transform: scale(0); }
    70% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.modal-body {
    padding: 35px;
}

.reservation-summary {
    background: rgba(126, 200, 227, 0.05);
    border-radius: 16px;
    padding: 25px;
    margin-bottom: 25px;
    border: 1px solid rgba(126, 200, 227, 0.2);
}

.summary-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--deep-blue);
    margin-bottom: 20px;
    text-align: center;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.summary-item {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.summary-label {
    font-size: 0.9rem;
    color: #718096;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.summary-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2d3748;
}

.reference-box {
    background: linear-gradient(135deg, 
        rgba(126, 200, 227, 0.1), 
        rgba(255, 155, 201, 0.1)
    );
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 2px dashed var(--sky-blue);
    margin: 25px 0;
}

.reference-label {
    font-size: 0.9rem;
    color: #718096;
    margin-bottom: 8px;
}

.reference-code {
    font-family: 'Courier New', monospace;
    font-size: 2rem;
    font-weight: 900;
    color: var(--deep-blue);
    letter-spacing: 2px;
    text-shadow: 0 2px 8px rgba(126, 200, 227, 0.2);
}

.instructions-box {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-top: 25px;
    border-left: 4px solid var(--success-green);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.instructions-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--deep-blue);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.instructions-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.instructions-list li {
    padding: 8px 0;
    padding-left: 25px;
    position: relative;
    color: #555;
}

.instructions-list li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: var(--success-green);
    font-weight: bold;
}

.modal-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 30px;
}

.modal-btn {
    padding: 16px 24px;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.modal-btn.primary {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 8px 20px rgba(126, 200, 227, 0.3);
}

.modal-btn.secondary {
    background: white;
    color: var(--deep-blue);
    border: 2px solid var(--sky-blue);
}

.modal-btn.close-btn {
    background: #f8fafc;
    color: #64748b;
    border: 2px solid #e2e8f0;
}

.modal-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 25px rgba(126, 200, 227, 0.2);
}

.modal-btn:active {
    transform: translateY(0);
}

/* üí´ √âcran de chargement */
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    flex-direction: column;
}

.loader {
    width: 60px;
    height: 60px;
    border: 3px solid transparent;
    border-top: 3px solid var(--sky-blue);
    border-bottom: 3px solid var(--light-pink);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ‚ú® Instructions √©l√©gantes */
.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.feature-card {
    background: white;
    border-radius: 16px;
    padding: 25px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(126, 200, 227, 0.15);
}

.feature-icon {
    width: 70px;
    height: 70px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: white;
    margin: 0 auto 15px;
    box-shadow: 0 8px 20px rgba(126, 200, 227, 0.3);
}

.feature-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--deep-blue);
    margin-bottom: 8px;
}

.feature-description {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.5;
}

/* üì± Responsive */
@media (max-width: 768px) {
    .reservation-card {
        padding: 25px 20px;
        margin: 0 15px 20px;
    }
    
    .main-title {
        font-size: 2rem;
    }
    
    .doctor-info {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
    
    .appointment-details {
        flex-direction: column;
        gap: 10px;
        width: 100%;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .options-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .modal-content {
        margin: 10px;
    }
    
    .modal-actions {
        grid-template-columns: 1fr;
    }
    
    .features-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .options-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-body {
        padding: 25px 20px;
    }
    
    .summary-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block body %}
<div class="reservation-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xxl-10">
                <!-- üíé Carte principale -->
                <div class="reservation-card">
                    <h1 class="main-title">
                        üå∏ R√©server votre consultation
                    </h1>
                    
                    <!-- üéÄ En-t√™te du m√©decin compact -->
                    <div class="doctor-header">
                        <div class="doctor-info">
                            <div class="doctor-avatar">
                                üë®‚Äç‚öïÔ∏è
                            </div>
                            <div class="doctor-details">
                                <h2 class="doctor-name">Dr. {{ creneau.nomMedecin }}</h2>
                                <p class="doctor-specialty">{{ creneau.consultation.categorie }}</p>
                                <p style="color: #666; font-size: 0.95rem;">
                                    <i class="fas fa-video me-1"></i> Consultation vid√©o
                                </p>
                            </div>
                        </div>
                        
                        <div class="appointment-details">
                            <div class="detail-item">
                                <span class="detail-icon"><i class="fas fa-calendar-alt"></i></span>
                                <span>{{ creneau.dateDebut|date('d/m/Y') }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-icon"><i class="fas fa-clock"></i></span>
                                <span>{{ creneau.dateDebut|date('H:i') }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- üìù Formulaire de r√©servation compact -->
                    {{ form_start(form, {'attr': {'id': 'reservationForm'}}) }}
                    
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user-circle me-2"></i> Vos informations
                        </h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">Pr√©nom</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-user input-icon"></i>
                                    {{ form_widget(form.prenom, {'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Votre pr√©nom'
                                    }}) }}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Nom</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-user input-icon"></i>
                                    {{ form_widget(form.nom, {'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Votre nom'
                                    }}) }}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">Email</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-envelope input-icon"></i>
                                    {{ form_widget(form.email, {'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'votre@email.com'
                                    }}) }}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">T√©l√©phone</label>
                                <div class="input-wrapper">
                                    <i class="fas fa-phone input-icon"></i>
                                    {{ form_widget(form.telephone, {'attr': {
                                        'class': 'form-control',
                                        'placeholder': '06 12 34 56 78'
                                    }}) }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
    <h3 class="section-title">
        <i class="fas fa-heartbeat me-2"></i> Informations m√©dicales
    </h3>
    
    <!-- üë• S√©lection du patient - SOLUTION D√âFINITIVE -->
    <div class="selection-group">
        <label class="selection-label required">Pour qui ?</label>
        <div class="options-grid">
            <div class="option-card" data-choice="MAMAN">
                <span class="option-icon">ü§∞</span>
                <span class="option-text">Maman</span>
                <input type="radio" 
                       name="reservation[typePatient]" 
                       value="MAMAN" 
                       id="typePatient_MAMAN"
                       class="visually-hidden">
            </div>
            <div class="option-card" data-choice="BEBE">
                <span class="option-icon">üë∂</span>
                <span class="option-text">B√©b√©</span>
                <input type="radio" 
                       name="reservation[typePatient]" 
                       value="BEBE" 
                       id="typePatient_BEBE"
                       class="visually-hidden">
            </div>
        </div>
        <!-- Input cach√© pour Symfony -->
        {{ form_widget(form.typePatient, {'attr': {'style': 'display: none;'}}) }}
    </div>
    
    <!-- üìÖ Champs conditionnels -->
    <div id="mamanFields" class="conditional-fields" style="display: none;">
        <div class="form-group">
            <label class="form-label">Mois de grossesse</label>
            <div class="input-wrapper">
                <i class="fas fa-baby input-icon"></i>
                {{ form_widget(form.moisGrossesse, {'attr': {
                    'class': 'form-control',
                    'placeholder': 'Exemple : 6'
                }}) }}
            </div>
        </div>
    </div>
    
    <div id="bebeFields" class="conditional-fields" style="display: none;">
        <div class="form-group">
            <label class="form-label">Date de naissance du b√©b√©</label>
            <div class="input-wrapper">
                <i class="fas fa-birthday-cake input-icon"></i>
                {{ form_widget(form.dateNaissanceBebe, {'attr': {
                    'class': 'form-control',
                    'placeholder': 'JJ/MM/AAAA'
                }}) }}
            </div>
        </div>
    </div>
    

    
    <!-- üìù Notes -->
    <div class="form-group textarea-group">
        <label class="form-label">Notes suppl√©mentaires</label>
        <div class="input-wrapper">
            <i class="fas fa-edit input-icon" style="top: 20px;"></i>
            {{ form_widget(form.notes, {'attr': {
                'class': 'form-control',
                'placeholder': 'Sympt√¥mes, questions ou informations importantes...',
                'rows': 4
            }}) }}
        </div>
    </div>
</div>
                    <!-- CSRF Token -->
                    {{ form_widget(form._token) }}
                    
                    <!-- ‚ú® Bouton d'action -->
                    <button type="button" class="action-button" id="btnReserver">
                        <i class="fas fa-calendar-check"></i>
                        Confirmer la r√©servation
                    </button>
                    
                    {{ form_end(form) }}
                </div>
                
                <!-- üí° Instructions -->
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üì±</div>
                        <h5 class="feature-title">Pr√©paration technique</h5>
                        <p class="feature-description">Webcam et micro fonctionnels requis pour une consultation optimale.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üåê</div>
                        <h5 class="feature-title">Connexion internet</h5>
                        <p class="feature-description">Une connexion stable est recommand√©e pour une exp√©rience fluide.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üìã</div>
                        <h5 class="feature-title">Pi√®ces √† pr√©parer</h5>
                        <p class="feature-description">Ayez votre carte vitale et pi√®ce d'identit√© √† port√©e de main.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- üåü Modal de confirmation professionnel -->
<div class="modal-overlay" id="confirmationModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="success-icon">
                ‚úì
            </div>
            <h2 style="font-size: 2rem; margin-bottom: 10px;">R√©servation confirm√©e !</h2>
            <p style="font-size: 1.1rem; opacity: 0.9;">
                Votre consultation est maintenant programm√©e
            </p>
        </div>
        
        <div class="modal-body">
            <!-- üìã R√©sum√© de la r√©servation -->
            <div class="reservation-summary">
                <h3 class="summary-title">D√©tails de votre rendez-vous</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="summary-label">M√©decin</span>
                        <span class="summary-value">Dr. {{ creneau.nomMedecin }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Date</span>
                        <span class="summary-value">{{ creneau.dateDebut|date('d/m/Y') }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Heure</span>
                        <span class="summary-value">{{ creneau.dateDebut|date('H:i') }}</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Type</span>
                        <span class="summary-value">Consultation vid√©o</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Patient</span>
                        <span class="summary-value" id="patientNameModal"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Sp√©cialit√©</span>
                        <span class="summary-value">{{ creneau.consultation.categorie }}</span>
                    </div>
                </div>
            </div>
            
            <!-- üî¢ R√©f√©rence -->
            <div class="reference-box">
                <div class="reference-label">Votre num√©ro de r√©f√©rence</div>
                <div id="referenceNumber" class="reference-code"></div>
                <p style="color: #718096; font-size: 0.9rem; margin-top: 10px;">
                    Conservez ce num√©ro pour tout suivi
                </p>
            </div>
            
            <!-- üìù Instructions -->
            <div class="instructions-box">
                <h4 class="instructions-title">
                    <i class="fas fa-info-circle"></i>
                    Prochaines √©tapes
                </h4>
                <ul class="instructions-list">
                    <li>Un email de confirmation vous a √©t√© envoy√© avec le lien de connexion</li>
                    <li>Connectez-vous 5 minutes avant l'heure pr√©vue</li>
                    <li>Assurez-vous d'avoir une connexion internet stable</li>
                    <li>Ayez votre pi√®ce d'identit√© √† port√©e de main</li>
                    <li>Pour toute question, contactez-nous au 01 23 45 67 89</li>
                </ul>
            </div>
            
            <!-- üéØ Actions -->
            <div class="modal-actions">
                <button type="button" class="modal-btn primary" onclick="window.print()">
                    <i class="fas fa-print"></i>
                    Imprimer
                </button>
                <button type="button" class="modal-btn secondary" onclick="window.location.href='{{ path('app_consultations') }}'">
                    <i class="fas fa-home"></i>
                    Retour √† l'accueil
                </button>
                <button type="button" class="modal-btn close-btn" id="btnCloseModal" style="grid-column: 1 / -1;">
                    <i class="fas fa-times"></i>
                    Fermer
                </button>
            </div>
        </div>
    </div>
</div>

<!-- üí´ √âcran de chargement -->
<div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
    <p style="color: var(--deep-blue); font-size: 1.2rem; font-weight: 600; margin-top: 20px;">
        Traitement de votre r√©servation...
    </p>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // üé≠ Gestion des s√©lecteurs visuels
    document.querySelectorAll('.option-card').forEach(option => {
        option.addEventListener('click', function() {
            const group = this.closest('.options-grid');
            const radio = this.querySelector('input[type="radio"]');
            
            // D√©s√©lectionner tous dans le groupe
            group.querySelectorAll('.option-card').forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('input[type="radio"]').checked = false;
            });
            
            // S√©lectionner celui-ci
            this.classList.add('selected');
            radio.checked = true;
            
            // Afficher/masquer les champs conditionnels
            if (radio.name === 'reservation[typePatient]') {
                const mamanFields = document.getElementById('mamanFields');
                const bebeFields = document.getElementById('bebeFields');
                
                mamanFields.style.display = radio.value === 'MAMAN' ? 'block' : 'none';
                bebeFields.style.display = radio.value === 'BEBE' ? 'block' : 'none';
                
                // Animation d'apparition
                if (mamanFields.style.display === 'block' || bebeFields.style.display === 'block') {
                    const fields = mamanFields.style.display === 'block' ? mamanFields : bebeFields;
                    fields.style.animation = 'fadeIn 0.4s ease';
                }
            }
        });
    });

    // üéØ Validation am√©lior√©e
    function validateForm() {
        let isValid = true;
        
        // Validation des champs requis
        const requiredFields = [
            { selector: '[name="reservation[nom]"]', name: 'nom' },
            { selector: '[name="reservation[prenom]"]', name: 'prenom' },
            { selector: '[name="reservation[email]"]', name: 'email' },
            { selector: '[name="reservation[telephone]"]', name: 'telephone' }
        ];
        
        requiredFields.forEach(field => {
            const input = document.querySelector(field.selector);
            const wrapper = input?.closest('.form-group');
            
            if (input && !input.value.trim()) {
                isValid = false;
                input.style.borderColor = '#EF4444';
                input.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                
                // Ajouter un message d'erreur
                if (!wrapper.querySelector('.error-message')) {
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = 'Ce champ est obligatoire';
                    errorMsg.style.cssText = `
                        color: #EF4444;
                        font-size: 0.85rem;
                        margin-top: 5px;
                        animation: fadeIn 0.3s ease;
                    `;
                    wrapper.appendChild(errorMsg);
                }
            } else {
                // Supprimer les erreurs si le champ est valide
                input.style.borderColor = '';
                input.style.boxShadow = '';
                const errorMsg = wrapper?.querySelector('.error-message');
                if (errorMsg) errorMsg.remove();
            }
        });
        
        // Validation email
        const emailInput = document.querySelector('[name="reservation[email]"]');
        const emailWrapper = emailInput?.closest('.form-group');
        
        if (emailInput && emailInput.value.trim()) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailInput.value)) {
                isValid = false;
                emailInput.style.borderColor = '#EF4444';
                emailInput.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                
                if (!emailWrapper.querySelector('.error-message')) {
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'error-message';
                    errorMsg.textContent = 'Adresse email invalide';
                    errorMsg.style.cssText = `
                        color: #EF4444;
                        font-size: 0.85rem;
                        margin-top: 5px;
                        animation: fadeIn 0.3s ease;
                    `;
                    emailWrapper.appendChild(errorMsg);
                }
            }
        }
        
        // Validation type patient
        const typePatient = document.querySelector('input[name="reservation[typePatient]"]:checked');
        if (!typePatient) {
            isValid = false;
            const selector = document.querySelector('.selection-group:first-child');
            selector.style.animation = 'shake 0.5s ease';
            setTimeout(() => selector.style.animation = '', 500);
            
            if (!selector.querySelector('.error-message')) {
                const errorMsg = document.createElement('div');
                errorMsg.className = 'error-message';
                errorMsg.textContent = 'Veuillez s√©lectionner une option';
                errorMsg.style.cssText = `
                    color: #EF4444;
                    font-size: 0.85rem;
                    margin-top: 10px;
                    text-align: center;
                    animation: fadeIn 0.3s ease;
                `;
                selector.appendChild(errorMsg);
            }
        }
        
        return isValid;
    }

    // üéá Bouton de r√©servation
    const btnReserver = document.getElementById('btnReserver');
    const form = document.getElementById('reservationForm');
    const modal = document.getElementById('confirmationModal');
    const overlay = document.querySelector('.modal-overlay');
    const loading = document.getElementById('loadingScreen');
    const btnCloseModal = document.getElementById('btnCloseModal');

    btnReserver.addEventListener('click', async function() {
        // Validation
        if (!validateForm()) {
            // Effet visuel d'erreur
            btnReserver.style.background = 'linear-gradient(135deg, #EF4444 0%, #F87171 100%)';
            btnReserver.innerHTML = '<i class="fas fa-exclamation-circle"></i> Formulaire incomplet';
            
            setTimeout(() => {
                btnReserver.style.background = '';
                btnReserver.innerHTML = '<i class="fas fa-calendar-check"></i> Confirmer la r√©servation';
            }, 2000);
            return;
        }

        // Affichage du chargement
        loading.style.display = 'flex';
        btnReserver.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Traitement en cours...';
        btnReserver.disabled = true;

        try {
            // Envoi AJAX
            const formData = new FormData(form);
            
            const response = await fetch('{{ path('app_creneau_reserver', {'id': creneau.id}) }}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            });

            const data = await response.json();

            if (data.success) {
                // SUCC√àS
                setTimeout(() => {
                    loading.style.display = 'none';
                    btnReserver.disabled = false;
                    btnReserver.innerHTML = '<i class="fas fa-calendar-check"></i> Confirmer la r√©servation';
                    
                    // Mise √† jour du modal
                    document.getElementById('referenceNumber').textContent = data.reference;
                    document.getElementById('patientNameModal').textContent = data.patientName;
                    
                    // Affichage du modal
                    overlay.style.display = 'flex';
                    
                    // Confettis
                    createConfettiRain();
                    
                    // Son de succ√®s
                    playSuccessSound();
                    
                }, 1500);

            } else {
                // √âCHEC
                loading.style.display = 'none';
                btnReserver.disabled = false;
                btnReserver.innerHTML = '<i class="fas fa-calendar-check"></i> Confirmer la r√©servation';
                
                alert('‚ùå ' + (data.message || 'Erreur lors de la r√©servation. Veuillez r√©essayer.'));
            }

        } catch (error) {
            // ERREUR
            loading.style.display = 'none';
            btnReserver.disabled = false;
            btnReserver.innerHTML = '<i class="fas fa-calendar-check"></i> Confirmer la r√©servation';
            
            console.error('Erreur:', error);
            alert('‚ö†Ô∏è Erreur de connexion. Veuillez v√©rifier votre connexion internet et r√©essayer.');
        }
    });

    // Fermeture du modal
    btnCloseModal.addEventListener('click', function() {
        overlay.style.display = 'none';
    });
    
    overlay.addEventListener('click', function(e) {
        if (e.target === overlay) {
            overlay.style.display = 'none';
        }
    });

    // üéâ Confettis
    function createConfettiRain() {
        const colors = ['#7EC8E3', '#FF9BC9', '#A45DE2', '#4A6FA5', '#FFD166'];
        const emojis = ['üå∏', '‚ú®', 'üéâ', 'üí´', 'üåü', 'üíñ'];
        
        for (let i = 0; i < 40; i++) {
            const confetti = document.createElement('div');
            confetti.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
            confetti.style.cssText = `
                position: fixed;
                font-size: ${20 + Math.random() * 20}px;
                color: ${colors[Math.floor(Math.random() * colors.length)]};
                top: -50px;
                left: ${Math.random() * 100}vw;
                z-index: 10000;
                pointer-events: none;
                opacity: ${0.7 + Math.random() * 0.3};
                text-shadow: 0 2px 8px currentColor;
                animation: floatDown ${2 + Math.random() * 2}s linear forwards;
            `;
            
            document.body.appendChild(confetti);
            
            setTimeout(() => {
                confetti.remove();
            }, 4000);
        }
    }

    // üîî Son de succ√®s
    function playSuccessSound() {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        } catch (e) {
            console.log('Son non support√©');
        }
    }

    // üé¨ Animation CSS suppl√©mentaire
    const style = document.createElement('style');
    style.textContent = `
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes floatDown {
            0% { 
                transform: translateY(0) rotate(0deg) scale(1); 
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh) rotate(${360 + Math.random() * 360}deg) 
                         translateX(${Math.random() * 100 - 50}px) scale(0.5);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}